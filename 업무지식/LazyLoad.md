
# LazyLoad

원래 &lt;script&gt;라는 태그를 HTML에서 사용하면, 인라인으로 포함하기도 하고 다른 파일에 있는 스크립트를 불러오기도 한다. 이 때 &lt;script&gt; 태그의 위치에 따라 속도의 문제가 생길 수 있는데, 다소 처리 시간이 오래걸리는 스크립트는 문서 상단보다는 하단에 두는 편이 나은 이유가 이 때문이다. 

HTML 화면이 로드될 때 상단에 있다면 극단적으로 로딩이 길어지고 웹페이지가 보이지 않아 새로고침을 누르게되면 불필요한 트래픽도 증가하며 사용자 경험이 나빠지기 때문.

(비슷한 이유로 &lt;style&gt; 태그는 화면에 보이는 이미지와 직접적인 관련이 있기 때문에 빠른 로딩을 위해 &lt;head&gt; 부분에 위치시킨다.)




이러한 현상이 발생하는 이유는 &lt;script&gt; 태그로 실행되는 자바스크립트는 블록(block)모드로 실행되기 때문이다. 

블록(block)은 코드 내에서 중괄호( { } )로 둘러싸인 부분을 가르키는데, 이 중괄호 안에서 선언한 변수는 중괄호 안에서만 사용이 가능하다. 이를 유효 범위라고 한다. 

자바스크립트는 다른 언어와 다르게 "함수"가 있어서 함수를 블록 대신 사용하고, 이 함수를 여러곳에 활용하는 식으로 사용한다. &lt;script&gt; 태그는 블록모드로 실행되기 때문에 해당 스크립트가 전부 실행되어야만 이후 DOM을 화면에 출력하게 된다. 

즉, 다 읽고 꼭꼭 씹어서 소화까지 해야 결과물이 나오는 것. 따라서 간단한 코드면 모를까, 복잡한 처리를 수행하는 스크립트 코드일수록 화면이 잠시 멈춘 듯한 느낌을 주게 된다. 자바스크립트는 자체적으로 HTML을 그릴 수 있는 기능을 제공하기 때문에 브라우저들이 완료를 기다려준다. (document.write 등) 

자바스크립트에서 현재 HTML을 그릴지 아닐지를 구분할 수 없으니 잠시 기다려주는 것. 따라서 이러한 상황을 방지하기 위해 오래걸리는 &lt;script&gt; 태그를 HTML 하단에 배치하는 것이다. 그럼 일단 화면이 뜬 후에 기다리니까 사용자 경험에서도 훨씬 좋아진다. (화면이 다 떴는데 이미지만 조금 늦게 뜨는 경우 등)



여기까지 &lt;script&gt; 태그가 실행되는데, 속도가 저하될 수 있다는 것을 이해했다. 

이미지만 조금 늦게 뜬다던지 이러한 로드를 막기 위해서는 처음 페이지가 로드될 때  자바스크립트의 양을 분산해서 실행해야하는데, 대표적인 방법이 LazyLoad 방식이다. 

LazyLoad 방식은 자바스크립트를 바로 로드해서 실행하는 것이 아니라, 페이지 로드가 전부 이루어지고 나서 조금 늦게 로드 후 실행하는 방법이다. 

보통 이미지와 같이 사이즈가 큰 데이터를 로딩할 때, 사용자의 브라우저 화면에 나타나지 않는 이미지까지 한번에 로딩하면 페이지 로딩이 더 느려진다. 따라서 사용자 브라우저에 보이는 이미지만 로딩하고, 다른 이미지들은 스크롤을 하면서 가까워지면 로딩한다. 그래서 스크롤 조회라고 부르는 것. 

꼭 이미지 뿐만이 아니다. 웹에서 특정 위치나 컴포넌트에 도달했을 때 API를 호출하는 것, 지금 당장 요청한 것들만 빠르게 처리하는 방식이 LazyLoad 방식이다. 브라우저의 초기 렌더링 최적화를 위한 작업이다.


<!-- 2021.11.18 -->