
# XSS

XSS란 '유저가 웹 페이지에 접속하는 것으로 올바르지 않은 스크립트가 실행되는 취약점 또는 공격방법' 을 말한다. 사이트 간 스크립팅(또는 크로스 사이트 스크립팅, 영문 명칭 cross-site scripting, 영문 약어 XSS)이며 웹 애플리케이션에서 많이 나타나는 취약점으로, 웹사이트 관리자가 아닌 이가 웹 페이지에 악성 스크립트를 삽입할 수 있는 취약점이다. 

스크립트 내용에 따라서 쿠키나 세션 토큰 등의 탈취가 가능해서, 이를 인증이나 세션관리에 사용하고 있는 사이트에 침입하거나 심각한 피해를 입힐 가능성이 있다고 한다.

DOM의 요소를 다루면서, innerHTML 사용을 지양하라 하는 이유는 성능상의 문제도 있지만 XSS 공격에 취약하기 때문이다.

간단한 예시를 들어보면, input 태그에 작성된 내용이 DOM에 그대로 추가되는 코드가 있다고 하자.

그 input 태그에 script 코드를 작성해서 넣으면 웹 브라우저는 이를 스크립트 코드로 인식하고 띄운다.

해당 script 코드는 누가 작성한 것인지 알 수 없기 때문에 실행하게 된다.

이렇게 되면 제대로 입력값을 검사하지 않고 사용하는 것이므로, 그 안에 어떤 것이 들어가 있어도 실행을 하게 되므로, 거기에 바이러스 같은 것이 포함 되어 있다면 큰 공격을 받게 된다. 그리고 생각보다 많은 웹사이트들이 이러한 방어 조치를 하지 않아 공격을 받는 경우가 많다.


XSS 공격은 스크립트를 삽입하는 방식으로 발생하기 때문에, 이를 방지하기 위해 스크립트 태그에서 자주 사용되는 문자들을 필터링해주는 방법으로 방어가 가능하다.

예를 들어, < , > 이러한 꺽쇠는 [&lt &gt] 와 같이 변경된다. " 는 &quot가 된다.

이렇게 하면 사용자에게는 &lt;script&gt; 로 보일 수 있지만 문서에서는 그냥 문자열로 보여지게 된다.

(그래서 이걸 사용해서 .md에 태그를 쓰면 문자열이지만 코드처럼 보이게 할 수도 있겠다!!! )

관련해서 사용 방법 중 전자정부프레임워크 기준으로 HTMLTagFilter 클래스가 있다. 이를 구현하여 정규식 변환처리를 하면 해당 URL은(예를들어 .do로 끝나는 것) 필터를 거치게 되며 필터에서 정규식 변환 처리가 일어나게 된다.

따라서 정규식 변환에 문제가 생기는 경우 해당 메서드만 예외처리하거나, 현재 이슈의 경우 쌍따옴표를 제거하는 로직을 따로 태워야 한다.

만약 그 문자열이 보인다면 필터에서 quot 처리만 빼거나 DB에 넣기 전에 문자열 상태에서 quot가 존재하는 경우 다시 replace 하는 로직을 자바단에서 처리해주면 된다.


<!-- 2021.10.20 -->